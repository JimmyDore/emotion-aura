---
phase: 06.1-eye-wink-firework-particles
plan: 01
subsystem: particles
tags: [mediapipe, blendshapes, fireworks, particles, wink-detection]

requires:
  - phase: 06
    provides: "Dual-hand detection, shared ParticlePool, FaceLandmarker blendshapes"
provides:
  - "WinkDetector class detecting eye winks/blinks from blendshapes"
  - "FireworkSpawner function for radial particle bursts"
  - "8-color rotating firework palette"
  - "Randomized firework positions within screen halves"
affects: []

tech-stack:
  added: []
  patterns: ["Module-level color rotation counter", "Independent per-side cooldown timers"]

key-files:
  created:
    - src/ml/WinkDetector.ts
    - src/particles/FireworkSpawner.ts
  modified:
    - src/core/types.ts
    - src/core/constants.ts
    - src/main.ts

key-decisions:
  - "8-color rotating palette instead of fixed GOLD/CYAN per side"
  - "Randomized burst positions within screen half (X: 20-90%, Y: ±0.7)"
  - "15-20 second particle lifetime for long lingering effect"

patterns-established:
  - "Blendshape-based event detection with per-side cooldown timers"
  - "Batch particle spawning into shared pool for cross-effect interactions"

duration: 5min
completed: 2026-02-08
---

# Phase 6.1 Plan 01: WinkDetector + FireworkSpawner Summary

**Eye wink/blink detection via blendshapes triggering radial firework bursts with 8-color rotating palette and randomized positions across screen halves**

## Performance

- **Duration:** ~5 min
- **Started:** 2026-02-08
- **Completed:** 2026-02-08
- **Tasks:** 4 (2 planned + 2 improvements from checkpoint feedback)
- **Files modified:** 5

## Accomplishments
- WinkDetector reads eyeBlinkLeft/eyeBlinkRight blendshapes with 0.5 threshold and independent 250ms per-side cooldowns
- FireworkSpawner creates 150-particle radial bursts using existing ParticleSystem.spawn() API
- 8-color rotating palette (gold, cyan, hot pink, lime, purple, orange, mint, yellow) cycles on each wink
- Burst positions randomized within each screen half (X: 20-90% of half, Y: ±0.7)
- 15-20 second particle lifetime for dramatic lingering effect
- Shared ParticlePool means hand gesture force fields automatically affect firework particles

## Task Commits

Each task was committed atomically:

1. **Task 1: Add types, constants, WinkDetector, and FireworkSpawner** - `def82d4` (feat)
2. **Task 2: Wire WinkDetector and FireworkSpawner into main.ts** - `c6558d1` (feat)
3. **Task 3: Rotating color palette and random positions** - `821d874` (feat)
4. **Task 4: Increase particle lifetime to 15-20s** - `907ab02` (feat)

## Files Created/Modified
- `src/ml/WinkDetector.ts` - Wink/blink detection from blendshape scores with per-side cooldowns
- `src/particles/FireworkSpawner.ts` - Radial burst spawning with rotating colors and random positions
- `src/core/types.ts` - Added WinkSide type and WinkEvent interface
- `src/core/constants.ts` - Wink detection thresholds + firework parameters + 8-color palette
- `src/main.ts` - Wink detection and firework spawning wired into face frame branch

## Decisions Made
- Replaced fixed GOLD/CYAN colors with 8-color rotating palette per user feedback
- Randomized burst origin positions within screen halves per user feedback
- Increased particle lifetime from 5-8s to 15-20s per user feedback

## Deviations from Plan

### Checkpoint Feedback Improvements

**1. Color palette rotation (user request)**
- **Found during:** Checkpoint verification
- **Issue:** Fixed GOLD left / CYAN right felt repetitive
- **Fix:** Replaced with 8-color rotating palette cycling on each wink
- **Files modified:** src/core/constants.ts, src/particles/FireworkSpawner.ts
- **Commit:** 821d874

**2. Random positions (user request)**
- **Found during:** Checkpoint verification
- **Issue:** Fireworks always appeared at same position per side
- **Fix:** Randomized X (20-90% of half) and Y (±0.7) for each burst
- **Files modified:** src/core/constants.ts, src/particles/FireworkSpawner.ts
- **Commit:** 821d874

**3. Longer particle lifetime (user request)**
- **Found during:** Checkpoint verification
- **Issue:** 5-8 second lifetime felt too short
- **Fix:** Increased to 15-20 seconds
- **Files modified:** src/core/constants.ts
- **Commit:** 907ab02

---

**Total deviations:** 3 improvements from checkpoint feedback
**Impact on plan:** Enhanced visual experience per user preferences. No scope creep.

## Issues Encountered
None

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Eye wink firework feature complete and verified
- All existing features (emotion aura, hand gestures) continue working
- Phase 6.1 is the only phase in milestone v1.1

---
*Phase: 06.1-eye-wink-firework-particles*
*Completed: 2026-02-08*
